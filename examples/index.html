<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script>
    window.addEventListener(
      'error',
      (e) => {
        if (!e.target) return

        console.log({
          url: window.location.href,
          type: 'error',
          subType: 'resource',
          resourceUrl: e.target.src || e.target.href,
          resourceHtml: e.target.outerHTML,
          resourceType: e.target.tagName,
          startTime: performance.now(),
        })
      },
      true
    )

    // handle unhandledrejection
    window.addEventListener('unhandledrejection', (e) => {
      console.log({
        url: window.location.href,
        type: 'error',
        subType: 'promise',
        reason: e.reason?.stack,
        startTime: performance.now(),
      })
    })

    // handle js error
    window.onerror = (msg, url, line, column, error) => {
      console.log({
        url,
        type: 'error',
        subType: 'js',
        msg,
        line,
        column,
        error: error?.stack,
        startTime: performance.now(),
      })
    }
  </script>
</head>

<body>
  <img src="http://xxxss.ss.com/a.jpg" alt="">
  <script>
    function test () {
      return Promise.reject(Error('promise'))
    }

    test()

    console.error('console error test')

    throw Error('test')
  </script>
</body>

</html>